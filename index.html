<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinity Audiobook | AI-Powered Collective Knowledge</title>
    <style>
        :root {
            --primary: #00d2ff;
            --bg: #0a0a0c;
            --card: #16161a;
            --text-main: #eeeeee;
            --text-dim: #888888;
            --accent: #ff4d4d;
        }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            font-family: 'Inter', -apple-system, sans-serif;
            margin: 0; padding: 40px 20px;
        }

        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: var(--primary); letter-spacing: 2px; margin-bottom: 10px; }

        /* TAB Ê†∑Âºè‰ºòÂåñ */
        .tabs-nav {
            display: flex; justify-content: center; gap: 10px; margin-bottom: 40px;
        }
        .tab-btn {
            background: #1a1a1e; border: 1px solid #333; color: var(--text-dim);
            padding: 10px 20px; border-radius: 30px; cursor: pointer; transition: 0.3s;
        }
        .tab-btn.active {
            background: var(--primary); color: #000; border-color: var(--primary); font-weight: bold;
        }

        .container {
            max-width: 1200px; margin: 0 auto;
            display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }

        .book-card {
            background: var(--card); border: 1px solid #2a2a2a; border-radius: 18px;
            display: flex; padding: 20px; transition: 0.3s ease; position: relative;
        }
        .book-card:hover { transform: translateY(-5px); border-color: var(--primary); }

        .cover { width: 100px; height: 150px; border-radius: 8px; object-fit: cover; margin-right: 20px; }
        
        .book-info { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        
        /* Ê†áÈ¢òÂØπÈΩê‰øÆÊ≠£ */
        h3 { 
            font-size: 1.1rem; margin: 0 0 12px 0; line-height: 1.3;
            height: 2.6em; display: -webkit-box; -webkit-line-clamp: 2; 
            -webkit-box-orient: vertical; overflow: hidden;
        }

        .progress-wrapper { background: #222; height: 10px; border-radius: 5px; overflow: hidden; margin-bottom: 8px; }
        .progress-bar { background: linear-gradient(90deg, #00d2ff, #3a7bd5); height: 100%; width: 0%; transition: width 1s ease; }
        .stats { display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 18px; }

        /* ÂºπÁ™óÊ†∑Âºè‰øùÊåÅÂéüÊ†∑ */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: #16161a; border: 1px solid #333; padding: 30px; border-radius: 20px; max-width: 450px; width: 90%; }
        .info-section { background: rgba(255,255,255,0.03); padding: 12px; border-radius: 12px; margin: 10px 0; border-left: 4px solid var(--primary); font-size: 0.8rem; }
        
        .btn { flex: 1; border: none; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-support { background: var(--primary); color: #000; }
        .btn-support:disabled { background: #444; cursor: not-allowed; }
        .btn-boost { background: transparent; border: 1px solid #444; color: var(--text-dim); }

        @keyframes pulse-glow { 
            0% { box-shadow: 0 0 0px var(--primary); } 
            50% { box-shadow: 0 0 20px var(--primary); border-color: #fff; } 
            100% { box-shadow: 0 0 0px var(--primary); } 
        }
        .boosting { animation: pulse-glow 0.8s ease-in-out; }
        .loader { width: 30px; height: 30px; border: 3px solid #333; border-bottom-color: var(--primary); border-radius: 50%; display: inline-block; animation: rotation 1s linear infinite; }
        @keyframes rotation { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>

<body>
    <div class="header">
        <h1>INFINITY AUDIOBOOK</h1>
        <p style="color: #666; font-size: 0.9rem;">AI-Powered Collective Knowledge Initiative</p>
    </div>

    <div class="tabs-nav">
        <button class="tab-btn active" onclick="switchTab('Hot', this)">üî• Hot Picks</button>
        <button class="tab-btn" onclick="switchTab('New', this)">üÜï New Arrivals</button>
        <button class="tab-btn" onclick="switchTab('Archive', this)">üèõÔ∏è Archive</button>
    </div>

    <div class="container" id="book-container">
        <div style="text-align:center; grid-column: 1/-1; color: #444;">Initializing knowledge node...</div>
    </div>

    <div id="paymentModal" class="modal-overlay">
        <div class="modal-content">
            <div id="step-confirm">
                <h3 style="color: var(--primary); margin-top: 0;">Service Confirmation</h3>
                <div class="info-section">
                    <p><strong>Project:</strong> <span id="modalBookTitle"></span></p>
                    <p><strong>Service Fee:</strong> $0.99 (Digital Credits)</p>
                </div>
                <div class="info-section" style="background: rgba(0,210,255,0.1);">
                    <h4>üöÄ Early Access Reward</h4>
                    <p>Instant email delivery after payment. No waiting!</p>
                </div>
                <div style="margin: 15px 0; font-size: 0.75rem; color: #888; display: flex; gap: 8px;">
                    <input type="checkbox" id="tos-check" onchange="document.getElementById('final-btn').disabled = !this.checked">
                    <label for="tos-check">I agree to the <a href="terms.html" target="_blank" style="color:var(--primary)">Terms of Service</a>.</label>
                </div>
                <button id="final-btn" class="btn btn-support" style="width: 100%;" onclick="startSecureTransition()" disabled>Secure Checkout</button>
                <p style="text-align: center; font-size: 0.7rem; color: #444; margin-top: 15px; cursor: pointer;" onclick="closeModal()">Cancel</p>
            </div>
            <div id="step-loading" style="display:none; text-align: center; padding: 20px;">
                <div class="loader"></div>
                <p id="loader-text" style="color: var(--primary); font-weight: bold;">Establishing encryption...</p>
            </div>
        </div>
    </div>

    <script>
        let allBooks = [];
        let currentFilter = 'Hot';
        const container = document.getElementById('book-container');
        let currentBookId = '';

        // 1. Ëé∑ÂèñÊï∞ÊçÆ
        async function loadBooks() {
            try {
                // ÊõøÊç¢‰∏∫ÊÇ®ÈÉ®ÁΩ≤ÂêéÁöÑ Cloudflare Worker URL
                const response = await fetch('https://sparkling-recipe-6de6.infinityaudiobook.workers.dev/');
                allBooks = await response.json();
                render(); 
            } catch (e) {
                container.innerHTML = `<div style="grid-column: 1/-1; text-align: center;">Connection Failed. Please refresh.</div>`;
            }
        }

        // 2. Ê∏≤ÊüìÈÄªËæë (Âê´ËøáÊª§)
        function render() {
            container.innerHTML = '';
            const filtered = allBooks.filter(b => b.status === currentFilter);

            if(filtered.length === 0) {
                container.innerHTML = `<div style="grid-column: 1/-1; text-align: center; color:#444; padding:50px;">Nothing here yet. Try another tab!</div>`;
                return;
            }

            filtered.forEach(book => {
                const percent = ((book.progress / book.target) * 100).toFixed(1);
                container.innerHTML += `
                    <div class="book-card" id="card-${book.id}">
                        <img src="${book.img}" class="cover">
                        <div class="book-info">
                            <div class="badge">${book.status === 'Archive' ? 'Unlocked' : 'Crowdfunding'}</div>
                            <h3>${book.title}</h3>
                            <div class="progress-wrapper">
                                <div class="progress-bar" style="width: ${percent}%"></div>
                            </div>
                            <div class="stats">
                                <span><b>${percent}%</b></span>
                                <span>Target: ${book.target}</span>
                            </div>
                            <div class="actions">
                                <button class="btn btn-support" onclick="handlePayClick('${book.id}', '${book.title}')">
                                    ${book.status === 'Archive' ? 'Get Now' : '$0.99'}
                                </button>
                                <button class="btn btn-boost" onclick="handleBoost('${book.id}', '${book.title}')">üöÄ</button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // 3. Tab ÂàáÊç¢
        function switchTab(type, btn) {
            currentFilter = type;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            render();
        }

        // 4. ‰∫§‰∫íÈÄªËæë
        function handlePayClick(id, title) {
            currentBookId = id;
            document.getElementById('modalBookTitle').innerText = title;
            document.getElementById('paymentModal').style.display = 'flex';
        }

function startSecureTransition() {
    if (!currentBookId) {
        alert("Session expired, please select a book again.");
        return;
    }
    
    // ÁÇπÂáªÂêéÁ´ãÂç≥Á¶ÅÁî®ÊåâÈíÆÔºåÈò≤Ê≠¢ÈáçÂ§çÊèê‰∫§ËÆ¢Âçï
    document.getElementById('final-btn').disabled = true;
    document.getElementById('final-btn').innerText = "Redirecting...";

    document.getElementById('step-confirm').style.display = 'none';
    document.getElementById('step-loading').style.display = 'block';

    // Âª∫ËÆÆÔºöÂ¶ÇÊûúÊÇ®ÁöÑ PayPal ÊåâÈíÆÊòØ‚ÄúÁ´ãÂç≥Ë¥≠‰π∞‚ÄùÁ±ªÂûãÔºåËøôÁßçÊãºÊé•ÊñπÂºèÊòØÊ†áÂáÜÁöÑ
    const paypalButtonId = "ÊÇ®ÁöÑÁúüÂÆûID"; // ËøôÈáåÂ°´ÂÖ• ID
    const finalUrl = `https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=${paypalButtonId}&custom=${currentBookId}`;

    setTimeout(() => {
        window.location.href = finalUrl;
    }, 1200);
}

        function handleBoost(id, title) {
            const card = document.getElementById('card-' + id);
            card.classList.add('boosting');
            setTimeout(() => card.classList.remove('boosting'), 800);
            alert("üöÄ Boost link generated! Share this project to speed up progress.");
        }

        function closeModal() { document.getElementById('paymentModal').style.display = 'none'; }
        
        loadBooks(); // ÂêØÂä®
    </script>
</body>
</html>
